#!/bin/bash

# HashEndra Installation Script
# Author: Meshack Bahati
# GitHub: https://github.com/meshackbahati/HashEndra

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Detect if we are inside a HashEndra folder
if [ -f "Cargo.toml" ] && grep -q "name = \"hashendra\"" Cargo.toml; then
    IN_REPO=true
else
    IN_REPO=false
fi

cat << "EOF"
 [0;34m@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@%%%@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%@@@@@@@%%%%@@@@@%%%%@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@@@@@@%%%@@@@@%%@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@%%%@@@@@@@@@@@@%%@%%%%%@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*+*#%%@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@%@@%@@%@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%####%@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@%%@@%@@%@%@%@%@@@@%@%@%@@@@@@@%@@@@@%%@@@%%@@%@%%%%%%%%@
@@@@@@@@@@@@@@%%@@@@@@@@@@@@@@@@%%%@%@@@@%@@%%%@%@@%@%@%@@%@@@%@%@%@@@%%%%@%#%@%%%%%%%%@@%@%%%%%%@@@
@@@@@@@@@@@@@@#=+*#%%%@@@@@%@@@@%%%@%%%@%%@@%%%%@@@%@#@%@%%%%@%@%%%@@@@@%@@#%@%%%#*+=#%@@@@@@@@@@@@%
@@@@@@@@@@@@@@@#*#*+-=*%%%%%%@%@%%%@%%%%%%@@%%%%%%%%@%%%%%%%%@%@%%%@@@%@%%%%%*=-=*#**@@@@@@@@@@@@@%#
@@@@@@@@@@@@@@%@%+**++*+--*##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#*#--=*++*++#@%%@@@@@@@@@%##@
@@@@@@@@@@@@@@*******=*++*==-=-=+**##%%%%%%%%%%%%#####%%%%%%%%%%##*+=---==*++*=******+@@@@@@@@%###%@
@@@@@@@@@@@@@@@*#%###**++###==+=--::=*#%%%%%%#:--:...:+##%%%%#*=::--=+=-#*#++**##*%#*@@@@@%%%#*###@@
@@@@@@@@@@@@@@@@%**#%#***#*+=+*+-===-:+#%%%##*--=--.:=:.-*###+:-===-+*=-=*#***###**%@@@@@%%@@%%%#%@@
@@@@@@@@@@@@@@@#+++++*+++*#*#**+++==+=:#%%%%%+==+++++==+=+%%#-=++=++++*#***+++++++++*@@@@@@@@%@@%%@@
@@@@@@@@@@@@@@@@#=#+=+++++=*#**+++*=*+-#%%%%#=+++=#*#*%%%%%%#-+*-*+++*+#*=+++=+=+#=*@@@@@@@@@@@@%%%@
@@@@@@@@@@@@@@@@@@#++++*#+**=+***##+++*-#%%%*+++=**+*=%%%%%#-***+#****+-**+#*++++#@@@@@@@@@@%@@%%%%%
@@@@@@@@@@@@@@@@@@*++++++++++*+#+*#**+***++**=+==++=++*#*++*#*+**#*+#+*++++++++++*@@@@@@@@@%%@%%@@%%
@@@@@@@@@@@@@@@@@@@#+#******#*##=**+###+###+==+#*+++**=++%##+###=**=##*#******#+*@@@@@@@@@@%%%%@@@@@
@@@@@@@@@@@@@@@@@@@@@%#******#++#**####%##%-++*#+**+##*+=###%####**#++#*#****#%@@@@@@@@@@@@@%@@@@@@@
@@@@@@@@@@@@@@@@%@@@@@%+=***###*+*#***####%=***=-::-=***+%%###***#*+*###***=+%@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@#%@%##%*+**#*%#%%%##%+%#+==-=++*#%*%##%%##%*#**+*%##%%%#@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@%@%@@@@**%%@%#+*##**++####%%%+%##+*****#%%*%%%####++**#**+*%@@%#+@@%@@@@@%@@@@@@@@@@@%
@@@@@@@@@@@@@@%@%@@@%-#%%%%#%@@#++*****#*#%####%*##*%###*@#*#*****++#@@@#%####-%@%@@@@@@@%@@@@@@@@@@
@@@@@@@@@@@@@@@@%@@%*=%%##%*@@@@%%%+=+%+*#@###+%###*#+###@#*=%+=+%%%@@@@*##%##=*%@@@%%@@@@@@@@@@@@@@
@@@@@@@@@@@@@@%@%@%%++##%%#*%%@@@@@@@@%@@@+**#%##%###%##*=%@@%@@@@@@@@%@**###*+=%@@@%%@@@%@%@@@@@@@@
@@@@@@@@@@@@@@%@@@@%=**#++**%%%@%@@@%@@@%%=#*####%%#%##*#-%%@@@@@%@%%%%%*+*+*#*-%@@@@%@@@%@@@@@@@@@@
@@@@@@@@@@@@@@%@@@@%=+******%%%%#%%%%%%%+#=+*######%%##*+-#+%%%%%%%%%%%%*+#*##*-%@@@%%@@@%@@@@@@@@@@
@@@@@@@@@@@@@@@@%@@%+=#%%#*+%%#%###%###-*#%+*+%+..--+%+*+%%*-#%%##%%%#%%+*####+=%@@@%%@@@%@@@@@@@@@@
@@@@@@@@@@@@@@#@@@@@#-%#+=*=%%%%%##%#*+#*=++#+*=+-+*+#*#++=**=*##%%#%%%%+*+#%#=*@@@@%%@@@@@@@@@@@@@@
@@@@@@@@@@@@@@%@@@@@%-*#%#*+*%%%####*-..=*###++--=***%#%%##+:.:=**##%#%*+##%##-%@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@%@@@@@@#=%%*+#=%%@%%%##-.*-:----*-:-=--#####++#--##%%%@%%-%###*+*@@@@@@@@@@@@@@@@@@@@@
@%@@@@@%%@@@@@@@@@@@@@*##%##%+%@%%%%%=:%--::-*:+#*#%*=##****%=+%%%%%%%+%*#%%#*@@@@@@@@@@@@@@@@@@@@@@
@%@@@@@@@@%@@@%@@@@@@@%*%#%##%*%@%%@%+:%====+++**=#%*****##*%=+%@@@%%*#%*%#%*%@@@@@@@@@@@@@@@@@@@@@@
@%%%@@@@@@@@@@@@@@@@@@@%+%*%%#%*%@@@@*-#++*+#*++=--=+**##%**#=+%@@@%+%#%@%%+%@@@@@@@@@@@@@@@@@@@@@@@
@%%%@@@@%%#@@@@@@@@@@@@@%*%%@%#%%#%@@#==*+**+-::..---=+*##**=:+%@%##%#%%%%*%@@@@@@@@@@@@@@@@@@@@@@@@
@@%%%%@%@%%@@@@@@@@@@@@@@@##%@%#%%#*%%-:****=:-=+%%*++++##**::#%*#%##%%%##@@@@@@@@@@@@@@@@@@@@@@@@@@
@@%%%%%@@%@@@@@@@%@@@@@@@@@%*%%@@%#%%##++###+==+=##+*+++###+-*%%%##%%%%*#@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@%%%%@@@@@@@@@@@@@@@@@@@@@@##%%%%%%%@#+*#%*++***#*#***###+*@%#####%##@@@@@@@%@@@@@@@@@@@@@@@@@@@@@
@@@@%@@%@@@@@@@@@@@@@@@%@@@@@@@%#%%@%%%@#**%#*++=--++**#%**#@@%%@%#*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@#%@%@@@@%%%@@@%%@@%%%@@@@@@@@%**%%%@@%#*%%%%#*#%%%%%*#%@@%@%**%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@%#%%%@@@@%%%%%####%%@@@@@@@@@@@@@%##%%@@###%#*+*%%%###@@@%##%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@%%%%%@@@@@@@%%%%@%@@@@@@@@@@%@@@@@@@@@@%%%%#++*##*###%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@%%%%@@@@@@@@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#-.+*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@%%@@@@@@@@@@@%@@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@%#**%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@%@@%%#%@@@@@@@@@@@@@@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [0m
EOF
echo -e "${BLUE}------------------------------------------------------------------${NC}"
echo -e "${BLUE}                     Installing HashEndra                         ${NC}"
echo -e "${BLUE}              The Universal Hash & Encoding Oracle                ${NC}"
echo -e "${BLUE}                 Author: Meshack Bahati                           ${NC}"
echo -e "${BLUE}------------------------------------------------------------------${NC}"

# If not in repo, clone it
if [ "$IN_REPO" = false ]; then
    echo -e "\n${BLUE}[*] Tool not found in current directory. Cloning from GitHub...${NC}"
    if ! command -v git &> /dev/null; then
        echo -e "${RED}[!] Git is not installed. Please install git or run this script from the source folder.${NC}"
        exit 1
    fi
    git clone https://github.com/meshackbahati/HashEndra.git
    cd HashEndra
fi

# Check dependencies
echo -e "\n${BLUE}[*] Checking dependencies...${NC}"

if ! command -v rustc &> /dev/null; then
    echo -e "${YELLOW}[!] Rust is not installed. Attempting to install rustup...${NC}"
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
    source $HOME/.cargo/env
else
    echo -e "${GREEN}[+] Rust is already installed: $(rustc --version)${NC}"
fi

if ! command -v cargo &> /dev/null; then
    echo -e "${RED}[!] Cargo is not found in PATH. Even though Rust was detected, Cargo is missing.${NC}"
    echo -e "${YELLOW}[*] Try running: source \$HOME/.cargo/env and then run this script again.${NC}"
    exit 1
fi

# Build
echo -e "\n${BLUE}[*] Building HashEndra in release mode...${NC}"
if cargo build --release; then
    echo -e "${GREEN}[+] Build successful.${NC}"
else
    echo -e "${RED}[!] Build failed. Please check the error messages above.${NC}"
    exit 1
fi

# Install
INSTALL_DIR="$HOME/.local/bin"
mkdir -p "$INSTALL_DIR"

if cp target/release/hashendra "$INSTALL_DIR/hashendra"; then
    echo -e "\n${GREEN}[+] HashEndra has been installed to $INSTALL_DIR/hashendra${NC}"
    
    # Check if INSTALL_DIR is in PATH
    if [[ ":$PATH:" != *":$INSTALL_DIR:"* ]]; then
        echo -e "${YELLOW}[!] Warning: $INSTALL_DIR is not in your PATH.${NC}"
        echo -e "${BLUE}[*] Add this line to your .bashrc or .zshrc:${NC}"
        echo -e "${GREEN}    export PATH=\"\$PATH:\$HOME/.local/bin\"${NC}"
    fi
    
    echo -e "\n${BLUE}[*] You can now run the tool using: ${GREEN}hashendra <input>${NC}"
else
    echo -e "${RED}[!] Failed to copy binary to $INSTALL_DIR. Check permissions.${NC}"
    exit 1
fi

echo -e "\n${GREEN}Installation Complete!${NC}"
